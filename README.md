# User Authentication Microservices

This project consists of three microservices that handle user authentication with Redis-based session management:

1. **user-registration** - Handles user registration with validation
2. **user-login** - Handles user authentication and session management
3. **user-logout** - Handles session termination

## Architecture

- **Database**: MongoDB for user data storage
- **Cache**: Redis for session management
- **Security**: JWT tokens with Redis session validation
- **Validation**: Email format and password strength validation
- **Encryption**: BCrypt for password hashing

## Prerequisites

- Java 17+
- Maven 3.6+
- MongoDB running on localhost:27017
- Redis running on localhost:6379

## Services Overview

### User Registration Service (Port 8081)
- **Endpoint**: `POST /api/register`
- **Database**: `patent_auth` collection `users`
- **Features**:
  - Email format validation
  - Password strength requirements (8+ chars, upper/lower case, digit)
  - Duplicate email prevention
  - BCrypt password hashing

### User Login Service (Port 8082)
- **Endpoints**: 
  - `POST /api/login` - Authenticate user
  - `POST /api/validate` - Validate session token
- **Features**:
  - JWT token generation with session ID
  - Redis session storage
  - Session expiration (24 hours)
  - Token validation

### User Logout Service (Port 8083)
- **Endpoints**:
  - `POST /api/logout` - Terminate session
  - `GET /api/session/status` - Check session status
- **Features**:
  - Redis session removal
  - Token validation
  - Session status checking

## API Documentation

### Registration
```bash
curl -X POST http://localhost:8081/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "SecurePass123"
  }'
```

**Response:**
```json
{
  "message": "User registered successfully"
}
```

### Login
```bash
curl -X POST http://localhost:8082/api/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "SecurePass123"
  }'
```

**Response:**
```json
{
  "token": "eyJhbGciOiJIUzUxMiJ9...",
  "message": "Login successful",
  "userId": "60f7b3b3b3b3b3b3b3b3b3b3",
  "email": "user@example.com"
}
```

### Validate Session
```bash
curl -X POST http://localhost:8082/api/validate \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Response:**
```json
{
  "valid": true,
  "userId": "60f7b3b3b3b3b3b3b3b3b3b3",
  "email": "user@example.com"
}
```

### Logout
```bash
curl -X POST http://localhost:8083/api/logout \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Response:**
```json
{
  "message": "Logout successful",
  "success": true,
  "userId": "60f7b3b3b3b3b3b3b3b3b3b3"
}
```

### Session Status
```bash
curl -X GET http://localhost:8083/api/session/status \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**Response:**
```json
{
  "valid": true,
  "userId": "60f7b3b3b3b3b3b3b3b3b3b3"
}
```

## Password Requirements

- Minimum 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one digit
- Valid email format

## Session Management

- Sessions are stored in Redis with a 24-hour expiration
- Each JWT token contains a unique session ID
- Sessions are automatically extended on validation
- Logout removes the session from Redis immediately
- JWT tokens are validated for structure, signature, and Redis session existence

## Error Handling

All services return appropriate HTTP status codes:
- `200` - Success
- `400` - Bad Request (validation errors)
- `401` - Unauthorized (authentication errors)
- `500` - Internal Server Error

## Security Features

1. **Password Encryption**: BCrypt with salt
2. **JWT Tokens**: HS512 signature algorithm
3. **Session Validation**: Double validation (JWT + Redis)
4. **Input Validation**: Email format and password strength
5. **CSRF Protection**: Disabled for API usage
6. **Secret Management**: Configurable JWT secret

## Running the Services

```bash
# Start Registration Service
cd user-registration
./mvnw spring-boot:run

# Start Login Service
cd user-login
./mvnw spring-boot:run

# Start Logout Service
cd user-logout
./mvnw spring-boot:run
```

## Configuration

Each service can be configured via `application.properties`:

- MongoDB URI
- Redis connection settings
- JWT secret and expiration
- Server ports

## Future Enhancements

The session tokens generated by this system can be used for:
- Encryption keys for other microservices
- Authorization for protected resources
- Single Sign-On (SSO) implementation
- Service-to-service authentication 
